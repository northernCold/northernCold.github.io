---
title: 访问者模式
tags:
---

## 什么是访问者模式？

访问者模式是一种将`数据操作`和`数据结构`分离的一种设计模式。

## 使用场景

1. 对象结构比较稳定，但经常需要在此对象上定义新的操作。
2. 需要对一个对象结构中的对象进行很多不同的且不相干的操作，而需要避免这种操作“污染”这些对象的类，也不希望在增加新操作时修改这些类。

## 角色介绍

Visitor：接口或者抽象类，定义了对每个 Element 访问的行为，它的参数就是被访问的元素，它的方法个数理论上与元素的个数是一样的，因此，访问者模式要求元素的类型要稳定，如果经常添加、移除元素类，必然会导致频繁地修改 Visitor 接口，如果出现这种情况，则说明不适合使用访问者模式。

ConcreteVisitor：具体的访问者，它需要给出对每一个元素类访问时所产生的具体行为。

Element：元素接口或者抽象类，它定义了一个接受访问者（accept）的方法，其意义是指每一个元素都要可以被访问者访问。

ElementA、ElementB：具体的元素类，它提供接受访问的具体实现，而这个具体的实现，通常情况下是使用访问者提供的访问该元素类的方法。

ObjectStructure：定义当中所提到的对象结构，对象结构是一个抽象表述，它内部管理了元素集合，并且可以迭代这些元素提供访问者访问。


## 优点和缺点

- 开闭原则。 你可以引入在不同类对象上执行的新行为， 且无需对这些类做出修改。

- 单一职责原则。 可将同一行为的不同版本移到同一个类中。

- 访问者对象可以在与各种对象交互时收集一些有用的信息。 当你想要遍历一些复杂的对象结构 （例如对象树）， 并在结构中的每个对象上应用访问者时， 这些信息可能会有所帮助。

### 缺点

- 每次在元素层次结构中添加或移除一个类时， 你都要更新所有的访问者。

- 在访问者同某个元素进行交互时， 它们可能没有访问元素私有成员变量和方法的必要权限。

https://www.jianshu.com/p/1f1049d0a0f4

https://refactoringguru.cn/design-patterns/visitor