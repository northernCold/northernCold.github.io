---
title: 什么是闭包
tags:
  - javascirpt
  - 闭包
date: 2021-10-02 08:50:30
---


> 可能会涉及到相关概念：执行上下文、词法环境、变量提升、垃圾回收、let/const暂时性死区、词法作用域、块级作用域

什么是闭包？

- 从技术的角度上讲：所有的函数都是闭包，因为它们都有一个人关联的它们的作用域，能够是它们访问到外层变量。
- 从实践的角度上讲：我们常常所说的闭包指的是让外部函数访问到内部的变量，也就是说，按照一般的做法，是使内部函数返回一个函数，然后操作其中的变量。这样做的话一是可以读取函数内部的变量，二是可以让这些变量的值始终保存在内存中

可以发现它们有个公共点，函数内访问到外部的变量的。让我具体介绍一下实践中的闭包。

1. 执行函数的时候，创建函数对应的*执行上下文*，[执行上下文内部的结构]()词法环境、变量环境随之创建。

> 词法环境（Lexical Environment）、变量环境（Variable Environment）都是属于词法环境（LexicalEnvironment），为了区分这两个词法环境，我把前者称之为词法环境、后者称为词法环境类。
>
> 词法环境是保存let/cont、class声明的变量
>
> 变量环境是保存var声明的变量以及函数声明

```javascript
ExecutionContext = {
	LexicalEnvironment,
	VariableEnvironment,
	...
}
```

2. 词法环境类是ECMA的一个规范类型，建立了标识符与变量的映射表。词法环境类内部包含了对**外层的引用**（父词法环境类） , 最外层的词法环境类为null。由外层的引用连接起来的词法环境类就是*作用域链*

```JavaScript
LexicalEnviromnent = {
   EnviromnetRecord,
   Outer, // 外层的引用
   ...
}
```



3. 当前函数可以通过这条作用域链访问到外层的变量，这些变量即使其执行文以及被销毁，还存在内存里。这些变量就是我们常说的闭包

# REFERENCE

- [JS夯实之执行上下文与词法环境](https://juejin.cn/post/6844904145372053511#heading-4)

- [JavaScript深入之闭包](https://github.com/mqyqingfeng/Blog/issues/9)

- [JavaScript技术指南的一段话](https://github.com/mqyqingfeng/Blog/issues/3#issuecomment-308667350)